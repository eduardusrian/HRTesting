<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>HR Testing 路 Multi-Level Access</title>
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Font: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,300..700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        :root {
            --bg: #f4f7fc;
            --surface: #ffffff;
            --surface-2: #f8fafd;
            --text: #1e293b;
            --text-light: #5e6f8d;
            --border: #e2eaf2;
            --primary: #0a5e9e;
            --primary-light: #e2f0ff;
            --success: #0e7342;
            --success-bg: #e1f7eb;
            --warning: #b55f0a;
            --warning-bg: #fff2e0;
            --danger: #b52b2b;
            --danger-bg: #ffe6e6;
            --card-shadow: 0 10px 30px -10px rgba(0,30,60,0.08);
        }

        body.dark {
            --bg: #0f1825;
            --surface: #1e2a3a;
            --surface-2: #253141;
            --text: #e9f1fb;
            --text-light: #a6bbd8;
            --border: #324153;
            --primary: #3b82f6;
            --primary-light: #253c5c;
            --success-bg: #1a3a2a;
            --warning-bg: #3f3020;
            --danger-bg: #3d2424;
            --card-shadow: 0 10px 30px -5px rgba(0,0,0,0.5);
        }

        body {
            background: var(--bg);
            color: var(--text);
            transition: background 0.2s, color 0.2s;
            padding: 12px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        .app-container {
            max-width: 1400px;
            width: 100%;
        }

        /* Navbar */
        .navbar {
            background: var(--surface);
            border-radius: 24px;
            padding: 12px 16px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 42px;
            height: 42px;
            background: linear-gradient(145deg, #1364b0, #0a4580);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 20px;
        }

        .logo-text h2 {
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--text);
        }
        .logo-text span {
            background: var(--primary-light);
            color: var(--primary);
            padding: 3px 10px;
            border-radius: 40px;
            font-size: 0.7rem;
            margin-left: 6px;
        }

        /* Role Selector */
        .role-selector {
            display: flex;
            gap: 8px;
            background: var(--surface-2);
            padding: 4px;
            border-radius: 40px;
            border: 1px solid var(--border);
        }
        .role-btn {
            padding: 8px 16px;
            border-radius: 30px;
            border: none;
            background: transparent;
            color: var(--text-light);
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: 0.2s;
            white-space: nowrap;
        }
        .role-btn.active {
            background: var(--primary);
            color: white;
        }

        .right-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .theme-toggle {
            background: var(--surface-2);
            border: 1px solid var(--border);
            border-radius: 40px;
            padding: 6px 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .avatar {
            width: 42px;
            height: 42px;
            background: linear-gradient(145deg, #1565c0, #0d47a1);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--surface);
            border-radius: 20px;
            padding: 16px;
            border: 1px solid var(--border);
            box-shadow: var(--card-shadow);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .stat-title {
            color: var(--text-light);
            font-weight: 500;
            font-size: 0.8rem;
        }
        .stat-icon {
            width: 36px;
            height: 36px;
            background: var(--primary-light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }
        .stat-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text);
            margin: 4px 0 2px;
        }
        .stat-trend {
            font-size: 0.7rem;
            color: var(--success);
            background: var(--success-bg);
            display: inline-block;
            padding: 3px 10px;
            border-radius: 30px;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: var(--surface);
            border-radius: 24px;
            border: 1px solid var(--border);
            padding: 18px;
            box-shadow: var(--card-shadow);
        }

        .card-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        .card-header h3 {
            font-weight: 700;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Table */
        .table-employee {
            width: 100%;
            overflow-x: auto;
        }

        .emp-row {
            display: grid;
            grid-template-columns: 2fr 1.2fr 1.5fr 0.8fr 0.8fr;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            min-width: 500px;
        }

        .emp-header {
            color: var(--text-light);
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
            padding: 8px 0;
            border-bottom: 2px solid var(--border);
        }

        .emp-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .emp-avatar {
            width: 34px;
            height: 34px;
            background: var(--primary-light);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--primary);
        }
        .emp-name {
            font-weight: 600;
            font-size: 0.9rem;
        }
        .emp-dept {
            background: var(--surface-2);
            padding: 3px 10px;
            border-radius: 30px;
            font-size: 0.75rem;
            color: var(--text-light);
            border: 1px solid var(--border);
            width: fit-content;
        }
        .status-active {
            background: var(--success-bg);
            color: var(--success);
            padding: 3px 10px;
            border-radius: 30px;
            font-size: 0.75rem;
            font-weight: 500;
            width: fit-content;
        }
        .actions i {
            margin: 0 4px;
            color: var(--text-light);
            cursor: pointer;
        }

        /* Leave items */
        .leave-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 0;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 10px;
        }
        .leave-employee {
            font-weight: 600;
            font-size: 0.9rem;
        }
        .leave-dates {
            font-size: 0.8rem;
            color: var(--text-light);
        }
        .leave-status {
            display: flex;
            gap: 8px;
        }
        .btn-approve, .btn-reject {
            border: none;
            padding: 5px 12px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.75rem;
            cursor: pointer;
        }
        .btn-approve {
            background: var(--success-bg);
            color: var(--success);
        }
        .btn-reject {
            background: var(--danger-bg);
            color: var(--danger);
        }
        .btn-add {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }
        .badge-filter {
            background: var(--surface-2);
            border-radius: 30px;
            padding: 5px 12px;
            font-size: 0.8rem;
            color: var(--text-light);
            border: 1px solid var(--border);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 16px;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: var(--surface);
            border-radius: 32px;
            padding: 24px;
            width: 450px;
            max-width: 100%;
            border: 1px solid var(--border);
        }
        .modal-content h2 {
            margin-bottom: 20px;
        }
        .modal-content input, .modal-content select {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 14px;
            border-radius: 20px;
            border: 1px solid var(--border);
            background: var(--surface-2);
            color: var(--text);
            outline: none;
        }
        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        .btn-save, .btn-cancel {
            padding: 12px;
            border-radius: 30px;
            font-weight: 600;
            flex: 1;
            cursor: pointer;
            border: none;
        }
        .btn-save {
            background: var(--primary);
            color: white;
        }
        .btn-cancel {
            background: var(--surface-2);
            color: var(--text);
            border: 1px solid var(--border);
        }

        /* Welcome Banner */
        .welcome-banner {
            background: var(--primary-light);
            border-radius: 20px;
            padding: 16px 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
            border: 1px solid var(--border);
        }
        .welcome-text h3 {
            font-size: 1.2rem;
            margin-bottom: 4px;
            color: var(--primary);
        }
        .welcome-text p {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                align-items: stretch;
            }
            .logo {
                justify-content: space-between;
                width: 100%;
            }
            .role-selector {
                width: 100%;
                justify-content: center;
            }
            .right-actions {
                justify-content: space-between;
                width: 100%;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Navbar with Role Selector -->
        <div class="navbar">
            <div class="logo">
                <div class="logo-icon">H</div>
                <div class="logo-text">
                    <h2>HR Testing <span>Multi-Level</span></h2>
                </div>
            </div>
            
            <!-- Role Selector -->
            <div class="role-selector" id="roleSelector">
                <button class="role-btn active" data-role="admin"> Admin</button>
                <button class="role-btn" data-role="manager"> Manager</button>
                <button class="role-btn" data-role="employee"> Karyawan</button>
            </div>

            <div class="right-actions">
                <div class="theme-toggle" id="themeToggle">
                    <i class="fas fa-sun"></i>
                    <i class="fas fa-moon"></i>
                </div>
                <div class="avatar" id="userAvatar">AD</div>
            </div>
        </div>

        <!-- Welcome Banner (dinamis) -->
        <div class="welcome-banner" id="welcomeBanner">
            <div class="welcome-text">
                <h3 id="welcomeTitle">Selamat datang, Admin!</h3>
                <p id="welcomeDesc">Anda memiliki akses penuh ke semua fitur HR Testing</p>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid" id="statsContainer">
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Total Karyawan</span>
                    <span class="stat-icon"><i class="fas fa-users"></i></span>
                </div>
                <div class="stat-number" id="totalEmployees">0</div>
                <span class="stat-trend">aktif semua</span>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Tim Saya</span>
                    <span class="stat-icon"><i class="fas fa-user-friends"></i></span>
                </div>
                <div class="stat-number" id="myTeam">0</div>
                <span class="stat-trend">anggota</span>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Cuti Pending</span>
                    <span class="stat-icon"><i class="fas fa-clock"></i></span>
                </div>
                <div class="stat-number" id="pendingLeaves">0</div>
                <span class="stat-trend">perlu approval</span>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Sisa Cuti Saya</span>
                    <span class="stat-icon"><i class="fas fa-umbrella-beach"></i></span>
                </div>
                <div class="stat-number" id="myLeave">12</div>
                <span class="stat-trend">hari</span>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Left Panel (berubah sesuai role) -->
            <div class="card" id="leftPanel">
                <!-- Konten akan diisi JS -->
            </div>

            <!-- Right Panel (notifications) -->
            <div>
                <div class="card" style="margin-bottom: 20px;" id="approvalCard">
                    <div class="card-header">
                        <h3><i class="fas fa-bell" style="color: var(--primary);"></i> <span id="approvalTitle">Pending Approvals</span></h3>
                        <span class="badge-filter" id="approvalBadge">3</span>
                    </div>
                    <div id="approvalList"></div>
                </div>
                <div class="card" id="infoCard">
                    <div class="card-header">
                        <h3><i class="fas fa-calendar" style="color: var(--primary);"></i> <span id="infoTitle">Informasi Terkini</span></h3>
                    </div>
                    <div id="infoList"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div style="text-align: center; margin-top: 24px; color: var(--text-light); font-size: 0.75rem; padding: 12px;">
            <i class="fas fa-users-cog"></i> 3 Level User: Admin 路 Manager 路 Karyawan 路 HR Testing Platform
        </div>
    </div>

    <!-- Modal untuk cuti (karyawan) -->
    <div class="modal" id="leaveModal">
        <div class="modal-content">
            <h2>Ajukan Cuti</h2>
            <select id="leaveType">
                <option value="tahunan">Cuti Tahunan</option>
                <option value="sakit">Cuti Sakit</option>
                <option value="penting">Cuti Kepentingan</option>
            </select>
            <input type="text" id="leaveDates" placeholder="Tanggal (contoh: 21-25 Feb 2026)">
            <div class="modal-actions">
                <button class="btn-save" id="submitLeave">Ajukan</button>
                <button class="btn-cancel" id="cancelLeave">Batal</button>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // ==================== DATA ====================
            let employees = [
                { id: 1, name: 'Amelia S.', dept: 'IT', position: 'Developer', manager: 'Budi P.', leaveQuota: 12 },
                { id: 2, name: 'Budi P.', dept: 'Finance', position: 'Manager Finance', manager: 'Denny W.', leaveQuota: 12 },
                { id: 3, name: 'Citra L.', dept: 'Marketing', position: 'Staff Marketing', manager: 'Budi P.', leaveQuota: 10 },
                { id: 4, name: 'Denny W.', dept: 'HRD', position: 'HR Manager', manager: 'Amelia S.', leaveQuota: 12 },
                { id: 5, name: 'Eka F.', dept: 'Operational', position: 'Supervisor', manager: 'Budi P.', leaveQuota: 8 },
                { id: 6, name: 'Fajar R.', dept: 'IT', position: 'Developer', manager: 'Amelia S.', leaveQuota: 12 },
                { id: 7, name: 'Gita N.', dept: 'Marketing', position: 'Staff', manager: 'Citra L.', leaveQuota: 5 },
            ];

            let leaveRequests = [
                { id: 101, employee: 'Citra L.', dept: 'Marketing', dates: '21-25 Feb 2026', type: 'tahunan', status: 'pending', manager: 'Budi P.' },
                { id: 102, employee: 'Fajar R.', dept: 'IT', dates: '1-5 Mar 2026', type: 'tahunan', status: 'pending', manager: 'Amelia S.' },
                { id: 103, employee: 'Gita N.', dept: 'Marketing', dates: '22-23 Feb 2026', type: 'sakit', status: 'pending', manager: 'Citra L.' },
                { id: 104, employee: 'Eka F.', dept: 'Operational', dates: '10-12 Mar 2026', type: 'penting', status: 'approved', manager: 'Budi P.' },
            ];

            let reimbursements = [
                { desc: 'Konsumsi Rapat', employee: 'Ari W.', amount: 485000, status: 'pending', manager: 'Budi P.' },
                { desc: 'Transportasi Dinas', employee: 'Rina K.', amount: 250000, status: 'approved', manager: 'Citra L.' },
                { desc: 'Pelatihan', employee: 'Dedi S.', amount: 1200000, status: 'pending', manager: 'Amelia S.' },
            ];

            // ==================== STATE ====================
            let currentRole = 'admin'; // admin / manager / employee
            let currentUser = {
                admin: { name: 'Admin User', role: 'admin', avatar: 'AD', dept: 'Management' },
                manager: { name: 'Budi P.', role: 'manager', avatar: 'BP', dept: 'Finance', team: ['Citra L.', 'Eka F.'] },
                employee: { name: 'Citra L.', role: 'employee', avatar: 'CL', dept: 'Marketing', manager: 'Budi P.', leaveQuota: 10 }
            };

            // ==================== DOM ELEMENTS ====================
            const roleBtns = document.querySelectorAll('.role-btn');
            const themeToggle = document.getElementById('themeToggle');
            const userAvatar = document.getElementById('userAvatar');
            const welcomeTitle = document.getElementById('welcomeTitle');
            const welcomeDesc = document.getElementById('welcomeDesc');
            const leftPanel = document.getElementById('leftPanel');
            const approvalList = document.getElementById('approvalList');
            const infoList = document.getElementById('infoList');
            const approvalTitle = document.getElementById('approvalTitle');
            const infoTitle = document.getElementById('infoTitle');
            const approvalBadge = document.getElementById('approvalBadge');
            const totalEmployees = document.getElementById('totalEmployees');
            const myTeam = document.getElementById('myTeam');
            const pendingLeaves = document.getElementById('pendingLeaves');
            const myLeave = document.getElementById('myLeave');

            // Modal
            const leaveModal = document.getElementById('leaveModal');
            document.getElementById('cancelLeave').addEventListener('click', () => {
                leaveModal.classList.remove('active');
            });

            // ==================== RENDER FUNCTIONS ====================
            function renderByRole() {
                // Update avatar dan welcome
                const user = currentUser[currentRole];
                userAvatar.textContent = user.avatar;
                
                if (currentRole === 'admin') {
                    welcomeTitle.textContent = 'Selamat datang, Admin!';
                    welcomeDesc.textContent = 'Anda memiliki akses penuh ke semua fitur HR Testing';
                    renderAdminView();
                } else if (currentRole === 'manager') {
                    welcomeTitle.textContent = `Selamat datang, Manager ${user.name}`;
                    welcomeDesc.textContent = `Mengelola tim di divisi ${user.dept}`;
                    renderManagerView();
                } else {
                    welcomeTitle.textContent = `Halo, ${user.name}`;
                    welcomeDesc.textContent = `Karyawan divisi ${user.dept} 路 Manager: ${user.manager}`;
                    renderEmployeeView();
                }

                // Update stats
                updateStats();
            }

            function renderAdminView() {
                // Admin: melihat semua karyawan, bisa edit/hapus
                leftPanel.innerHTML = `
                    <div class="card-header">
                        <h3><i class="fas fa-users" style="color: var(--primary);"></i> Semua Karyawan</h3>
                        <div style="display: flex; gap: 10px;">
                            <select id="deptFilter" class="badge-filter">
                                <option value="all">Semua Divisi</option>
                                <option value="IT">IT</option>
                                <option value="HRD">HRD</option>
                                <option value="Finance">Finance</option>
                                <option value="Marketing">Marketing</option>
                            </select>
                            <button class="btn-add" id="addEmployeeBtn"><i class="fas fa-plus"></i> Tambah</button>
                        </div>
                    </div>
                    <div class="table-employee" id="employeeTable"></div>
                `;

                renderEmployeeTable();

                // Approval list untuk admin (semua pending)
                approvalTitle.textContent = 'Semua Pengajuan Pending';
                infoTitle.textContent = 'Ringkasan HR';
                
                let pendingLeavesList = leaveRequests.filter(l => l.status === 'pending');
                let approvalHtml = '';
                pendingLeavesList.forEach(l => {
                    approvalHtml += `
                        <div class="leave-item">
                            <div>
                                <div class="leave-employee">${l.employee} (${l.dept})</div>
                                <div class="leave-dates">${l.dates} 路 ${l.type}</div>
                            </div>
                            <div class="leave-status">
                                <button class="btn-approve" onclick="approveRequest(${l.id})"><i class="fas fa-check"></i> Setuju</button>
                                <button class="btn-reject" onclick="rejectRequest(${l.id})"><i class="fas fa-times"></i> Tolak</button>
                            </div>
                        </div>
                    `;
                });
                approvalList.innerHTML = approvalHtml || '<div style="padding: 16px; color: var(--text-light);">Tidak ada pending</div>';
                approvalBadge.textContent = pendingLeavesList.length;

                // Info list
                infoList.innerHTML = `
                    <div class="leave-item">
                        <div>
                            <div class="leave-employee">Total Divisi</div>
                            <div class="leave-dates">5 divisi aktif</div>
                        </div>
                    </div>
                    <div class="leave-item">
                        <div>
                            <div class="leave-employee">Pengajuan Bulan Ini</div>
                            <div class="leave-dates">${leaveRequests.length} pengajuan</div>
                        </div>
                    </div>
                `;
            }

            function renderManagerView() {
                // Manager: hanya melihat timnya sendiri
                const user = currentUser.manager;
                const teamMembers = employees.filter(e => e.manager === user.name);
                
                leftPanel.innerHTML = `
                    <div class="card-header">
                        <h3><i class="fas fa-user-friends" style="color: var(--primary);"></i> Tim Saya (${teamMembers.length})</h3>
                        <span class="badge-filter">${user.dept}</span>
                    </div>
                    <div class="table-employee" id="employeeTable"></div>
                `;

                let tableHtml = `
                    <div class="emp-row emp-header">
                        <span>Nama</span>
                        <span>Divisi</span>
                        <span>Jabatan</span>
                        <span>Sisa Cuti</span>
                        <span>Aksi</span>
                    </div>
                `;
                teamMembers.forEach(emp => {
                    tableHtml += `
                        <div class="emp-row">
                            <div class="emp-info">
                                <div class="emp-avatar">${emp.name.charAt(0)}</div>
                                <span class="emp-name">${emp.name}</span>
                            </div>
                            <span><span class="emp-dept">${emp.dept}</span></span>
                            <span style="font-size:0.85rem;">${emp.position}</span>
                            <span>${emp.leaveQuota} hari</span>
                            <span class="actions">
                                <i class="fas fa-clock" onclick="showQuota(${emp.id})" title="Lihat detail"></i>
                            </span>
                        </div>
                    `;
                });
                document.getElementById('employeeTable').innerHTML = tableHtml;

                // Approval untuk manager (hanya pengajuan dari timnya)
                approvalTitle.textContent = 'Approval Tim';
                let teamLeaves = leaveRequests.filter(l => 
                    l.manager === user.name && l.status === 'pending'
                );
                let approvalHtml = '';
                teamLeaves.forEach(l => {
                    approvalHtml += `
                        <div class="leave-item">
                            <div>
                                <div class="leave-employee">${l.employee}</div>
                                <div class="leave-dates">${l.dates} 路 ${l.type}</div>
                            </div>
                            <div class="leave-status">
                                <button class="btn-approve" onclick="approveRequest(${l.id})">Setuju</button>
                                <button class="btn-reject" onclick="rejectRequest(${l.id})">Tolak</button>
                            </div>
                        </div>
                    `;
                });
                approvalList.innerHTML = approvalHtml || '<div style="padding: 16px;">Tidak ada pending approval</div>';
                approvalBadge.textContent = teamLeaves.length;

                // Info
                infoTitle.textContent = 'Ringkasan Tim';
                infoList.innerHTML = `
                    <div class="leave-item">
                        <div>
                            <div class="leave-employee">Sisa Cuti Tim</div>
                            <div class="leave-dates">${teamMembers.reduce((sum, e) => sum + e.leaveQuota, 0)} hari total</div>
                        </div>
                    </div>
                `;
            }

            function renderEmployeeView() {
                const user = currentUser.employee;
                
                leftPanel.innerHTML = `
                    <div class="card-header">
                        <h3><i class="fas fa-user" style="color: var(--primary);"></i> Profil Saya</h3>
                        <button class="btn-add" id="requestLeaveBtn"><i class="fas fa-plus"></i> Ajukan Cuti</button>
                    </div>
                    <div style="padding: 16px 0;">
                        <div style="display: flex; gap: 20px; align-items: center; margin-bottom: 20px;">
                            <div class="emp-avatar" style="width: 60px; height: 60px; font-size: 1.5rem;">${user.avatar}</div>
                            <div>
                                <h3 style="margin-bottom: 4px;">${user.name}</h3>
                                <p style="color: var(--text-light);">${user.dept} 路 Manager: ${user.manager}</p>
                            </div>
                        </div>
                        <div style="background: var(--surface-2); padding: 16px; border-radius: 16px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span>Sisa Cuti Tahunan</span>
                                <span style="font-weight: 700; font-size: 1.2rem;">${user.leaveQuota} hari</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Riwayat Cuti</span>
                                <span>${leaveRequests.filter(l => l.employee === user.name).length} pengajuan</span>
                            </div>
                        </div>
                    </div>
                `;

                // Untuk karyawan, approval list adalah status pengajuan mereka
                approvalTitle.textContent = 'Status Pengajuan Saya';
                let myRequests = leaveRequests.filter(l => l.employee === user.name);
                let approvalHtml = '';
                myRequests.forEach(l => {
                    let statusColor = l.status === 'approved' ? 'var(--success)' : l.status === 'pending' ? 'var(--warning)' : 'var(--danger)';
                    approvalHtml += `
                        <div class="leave-item">
                            <div>
                                <div class="leave-employee">${l.type} 路 ${l.dates}</div>
                                <div class="leave-dates" style="color: ${statusColor}; font-weight: 600;">${l.status.toUpperCase()}</div>
                            </div>
                        </div>
                    `;
                });
                approvalList.innerHTML = approvalHtml || '<div style="padding: 16px;">Belum ada pengajuan</div>';
                approvalBadge.textContent = myRequests.filter(r => r.status === 'pending').length;

                // Info untuk karyawan
                infoTitle.textContent = 'Pengumuman';
                infoList.innerHTML = `
                    <div class="leave-item">
                        <div>
                            <div class="leave-employee"> Libur Nasional</div>
                            <div class="leave-dates">28 Februari 2026</div>
                        </div>
                    </div>
                    <div class="leave-item">
                        <div>
                            <div class="leave-employee"> Gaji Bulanan</div>
                            <div class="leave-dates">Akan cair 25 Feb</div>
                        </div>
                    </div>
                `;

                // Event listener untuk tombol ajukan cuti
                setTimeout(() => {
                    document.getElementById('requestLeaveBtn')?.addEventListener('click', () => {
                        leaveModal.classList.add('active');
                    });
                }, 100);
            }

            function renderEmployeeTable() {
                if (currentRole !== 'admin') return;
                
                let filterDept = document.getElementById('deptFilter')?.value || 'all';
                let filtered = employees.filter(emp => {
                    if (filterDept !== 'all' && emp.dept !== filterDept) return false;
                    return true;
                });

                let html = `
                    <div class="emp-row emp-header">
                        <span>Nama</span>
                        <span>Divisi</span>
                        <span>Jabatan</span>
                        <span>Manager</span>
                        <span>Aksi</span>
                    </div>
                `;
                filtered.forEach(emp => {
                    html += `
                        <div class="emp-row">
                            <div class="emp-info">
                                <div class="emp-avatar">${emp.name.charAt(0)}</div>
                                <span class="emp-name">${emp.name}</span>
                            </div>
                            <span><span class="emp-dept">${emp.dept}</span></span>
                            <span style="font-size:0.85rem;">${emp.position}</span>
                            <span>${emp.manager}</span>
                            <span class="actions">
                                <i class="fas fa-edit" onclick="alert('Edit ${emp.name}')"></i>
                                <i class="fas fa-trash" onclick="if(confirm('Hapus?')) deleteEmployee(${emp.id})"></i>
                            </span>
                        </div>
                    `;
                });
                document.getElementById('employeeTable').innerHTML = html;

                // Re-attach filter event
                document.getElementById('deptFilter')?.addEventListener('change', renderEmployeeTable);
            }

            function updateStats() {
                totalEmployees.textContent = employees.length;
                
                if (currentRole === 'admin') {
                    myTeam.textContent = employees.length;
                    pendingLeaves.textContent = leaveRequests.filter(l => l.status === 'pending').length;
                    myLeave.textContent = '-';
                } else if (currentRole === 'manager') {
                    let teamCount = employees.filter(e => e.manager === currentUser.manager.name).length;
                    myTeam.textContent = teamCount;
                    pendingLeaves.textContent = leaveRequests.filter(l => 
                        l.manager === currentUser.manager.name && l.status === 'pending'
                    ).length;
                    myLeave.textContent = '12';
                } else {
                    myTeam.textContent = '1';
                    pendingLeaves.textContent = leaveRequests.filter(l => 
                        l.employee === currentUser.employee.name && l.status === 'pending'
                    ).length;
                    myLeave.textContent = currentUser.employee.leaveQuota;
                }
            }

            // ==================== ACTIONS ====================
            window.approveRequest = function(id) {
                let req = leaveRequests.find(l => l.id === id);
                if (req) {
                    req.status = 'approved';
                    renderByRole();
                }
            };

            window.rejectRequest = function(id) {
                let req = leaveRequests.find(l => l.id === id);
                if (req) {
                    req.status = 'rejected';
                    renderByRole();
                }
            };

            window.deleteEmployee = function(id) {
                employees = employees.filter(e => e.id !== id);
                renderByRole();
            };

            window.showQuota = function(id) {
                let emp = employees.find(e => e.id === id);
                alert(`Sisa cuti ${emp.name}: ${emp.leaveQuota} hari`);
            };

            document.getElementById('submitLeave')?.addEventListener('click', () => {
                let type = document.getElementById('leaveType').value;
                let dates = document.getElementById('leaveDates').value;
                if (!dates) return alert('Isi tanggal cuti');
                
                let newId = Math.max(...leaveRequests.map(l => l.id), 100) + 1;
                leaveRequests.push({
                    id: newId,
                    employee: currentUser.employee.name,
                    dept: currentUser.employee.dept,
                    dates: dates,
                    type: type,
                    status: 'pending',
                    manager: currentUser.employee.manager
                });
                
                leaveModal.classList.remove('active');
                renderByRole();
            });

            // ==================== EVENT LISTENERS ====================
            roleBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    roleBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentRole = btn.dataset.role;
                    renderByRole();
                });
            });

            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark');
            });

            // Initial render
            renderByRole();
        })();
    </script>
</body>
</html>
